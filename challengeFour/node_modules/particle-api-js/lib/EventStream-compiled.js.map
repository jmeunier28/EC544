{"version":3,"sources":["../../../../../../spark/particle-api-js/lib/EventStream.js"],"names":[],"mappings":"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","file":"EventStream-compiled.js","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n\tvalue: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _http = require('http');\n\nvar _http2 = _interopRequireDefault(_http);\n\nvar _https = require('https');\n\nvar _https2 = _interopRequireDefault(_https);\n\nvar _url = require('url');\n\nvar _url2 = _interopRequireDefault(_url);\n\nvar _events = require('events');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /* eslint max-depth: 0 */\n\n\nvar EventStream = function (_EventEmitter) {\n\t_inherits(EventStream, _EventEmitter);\n\n\tfunction EventStream(uri, token, options) {\n\t\t_classCallCheck(this, EventStream);\n\n\t\tvar _this = _possibleConstructorReturn(this, Object.getPrototypeOf(EventStream).call(this));\n\n\t\t_this.uri = uri;\n\t\t_this.token = token;\n\t\t_this.reconnectInterval = 2000;\n\t\tObject.assign(_this, options);\n\t\treturn _this;\n\t}\n\n\t_createClass(EventStream, [{\n\t\tkey: 'connect',\n\t\tvalue: function connect() {\n\t\t\tvar _this2 = this;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tvar _url$parse = _url2.default.parse(_this2.uri);\n\n\t\t\t\tvar hostname = _url$parse.hostname;\n\t\t\t\tvar protocol = _url$parse.protocol;\n\t\t\t\tvar port = _url$parse.port;\n\t\t\t\tvar path = _url$parse.path;\n\n\t\t\t\t_this2.origin = protocol + '//' + hostname + (port ? ':' + port : '');\n\n\t\t\t\tvar isSecure = protocol === 'https:';\n\t\t\t\tvar requestor = isSecure ? _https2.default : _http2.default;\n\t\t\t\tvar req = requestor.request({\n\t\t\t\t\thostname: hostname,\n\t\t\t\t\tprotocol: protocol,\n\t\t\t\t\tpath: path + '?history_limit=30&access_token=' + _this2.token,\n\t\t\t\t\tmethod: 'get',\n\t\t\t\t\tport: port || (isSecure ? 443 : 80),\n\t\t\t\t\tavoidFetch: true,\n\t\t\t\t\tmode: 'prefer-streaming'\n\t\t\t\t});\n\n\t\t\t\t_this2.req = req;\n\t\t\t\tif (_this2.debug) {\n\t\t\t\t\t_this2.debug(_this2);\n\t\t\t\t}\n\n\t\t\t\treq.on('error', function (e) {\n\t\t\t\t\treject({ error: e, errorDescription: 'Network error from ' + _this2.uri });\n\t\t\t\t});\n\n\t\t\t\treq.on('response', function (res) {\n\t\t\t\t\tvar statusCode = res.statusCode;\n\t\t\t\t\tif (statusCode !== 200) {\n\t\t\t\t\t\tvar _ret = function () {\n\t\t\t\t\t\t\tvar body = '';\n\t\t\t\t\t\t\tres.on('data', function (chunk) {\n\t\t\t\t\t\t\t\treturn body += chunk;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tres.on('end', function () {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tbody = JSON.parse(body);\n\t\t\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t\t\t\t_this2.emit('response', {\n\t\t\t\t\t\t\t\t\tstatusCode: statusCode,\n\t\t\t\t\t\t\t\t\tbody: body\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tvar errorDescription = 'HTTP error ' + statusCode + ' from ' + _this2.uri;\n\t\t\t\t\t\t\t\tif (body && body.error_description) {\n\t\t\t\t\t\t\t\t\terrorDescription += ' - ' + body.error_description;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treject({ statusCode: statusCode, errorDescription: errorDescription, body: body });\n\t\t\t\t\t\t\t\t_this2.req = undefined;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tv: void 0\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}();\n\n\t\t\t\t\t\tif ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === \"object\") return _ret.v;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this2.data = '';\n\t\t\t\t\t_this2.buf = '';\n\t\t\t\t\t_this2.eventName;\n\t\t\t\t\t_this2.lastEventId;\n\n\t\t\t\t\tres.on('data', _this2.parse.bind(_this2));\n\t\t\t\t\tres.once('end', _this2.end.bind(_this2));\n\t\t\t\t\tresolve(_this2);\n\t\t\t\t});\n\t\t\t\treq.end();\n\t\t\t});\n\t\t}\n\t}, {\n\t\tkey: 'abort',\n\t\tvalue: function abort() {\n\t\t\tif (this.req) {\n\t\t\t\tthis.req.abort();\n\t\t\t\tthis.req = undefined;\n\t\t\t}\n\t\t\tthis.removeAllListeners();\n\t\t}\n\t}, {\n\t\tkey: 'end',\n\t\tvalue: function end() {\n\t\t\tvar _this3 = this;\n\n\t\t\tthis.req = undefined;\n\t\t\tsetTimeout(function () {\n\t\t\t\t_this3.connect().catch(function (err) {\n\t\t\t\t\t_this3.emit('error', err);\n\t\t\t\t\t_this3.removeAllListeners();\n\t\t\t\t});\n\t\t\t}, this.reconnectInterval);\n\t\t}\n\t}, {\n\t\tkey: 'parse',\n\t\tvalue: function parse(chunk) {\n\t\t\tthis.buf += chunk;\n\t\t\tvar pos = 0;\n\t\t\tvar length = this.buf.length;\n\t\t\tvar discardTrailingNewline = false;\n\n\t\t\twhile (pos < length) {\n\t\t\t\tif (discardTrailingNewline) {\n\t\t\t\t\tif (this.buf[pos] === '\\n') {\n\t\t\t\t\t\t++pos;\n\t\t\t\t\t}\n\t\t\t\t\tdiscardTrailingNewline = false;\n\t\t\t\t}\n\n\t\t\t\tvar lineLength = -1;\n\t\t\t\tvar fieldLength = -1;\n\n\t\t\t\tfor (var i = pos; lineLength < 0 && i < length; ++i) {\n\t\t\t\t\tvar c = this.buf[i];\n\t\t\t\t\tif (c === ':') {\n\t\t\t\t\t\tif (fieldLength < 0) {\n\t\t\t\t\t\t\tfieldLength = i - pos;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (c === '\\r') {\n\t\t\t\t\t\tdiscardTrailingNewline = true;\n\t\t\t\t\t\tlineLength = i - pos;\n\t\t\t\t\t} else if (c === '\\n') {\n\t\t\t\t\t\tlineLength = i - pos;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (lineLength < 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tthis.parseEventStreamLine(pos, fieldLength, lineLength);\n\n\t\t\t\tpos += lineLength + 1;\n\t\t\t}\n\n\t\t\tif (pos === length) {\n\t\t\t\tthis.buf = '';\n\t\t\t} else if (pos > 0) {\n\t\t\t\tthis.buf = this.buf.slice(pos);\n\t\t\t}\n\t\t}\n\t}, {\n\t\tkey: 'parseEventStreamLine',\n\t\tvalue: function parseEventStreamLine(pos, fieldLength, lineLength) {\n\t\t\tif (lineLength === 0) {\n\t\t\t\ttry {\n\t\t\t\t\tif (this.data.length > 0 && this.eventName) {\n\t\t\t\t\t\tvar event = JSON.parse(this.data);\n\t\t\t\t\t\tevent.name = this.eventName;\n\t\t\t\t\t\tif (this.eventName !== 'event') {\n\t\t\t\t\t\t\tthis.emit(this.eventName, event);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.emit('event', event);\n\t\t\t\t\t\tthis.data = '';\n\t\t\t\t\t}\n\t\t\t\t\tthis.eventName = undefined;\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// do nothing if JSON.parse fails\n\t\t\t\t}\n\t\t\t} else if (fieldLength > 0) {\n\t\t\t\t\tvar field = this.buf.slice(pos, pos + fieldLength);\n\t\t\t\t\tvar step = 0;\n\n\t\t\t\t\tif (this.buf[pos + fieldLength + 1] !== ' ') {\n\t\t\t\t\t\tstep = fieldLength + 1;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstep = fieldLength + 2;\n\t\t\t\t\t}\n\t\t\t\t\tpos += step;\n\t\t\t\t\tvar valueLength = lineLength - step;\n\t\t\t\t\tvar value = this.buf.slice(pos, pos + valueLength);\n\n\t\t\t\t\tif (field === 'data') {\n\t\t\t\t\t\tthis.data += value + '\\n';\n\t\t\t\t\t} else if (field === 'event') {\n\t\t\t\t\t\tthis.eventName = value;\n\t\t\t\t\t} else if (field === 'id') {\n\t\t\t\t\t\tthis.lastEventId = value;\n\t\t\t\t\t} else if (field === 'retry') {\n\t\t\t\t\t\tvar retry = parseInt(value, 10);\n\t\t\t\t\t\tif (!Number.isNaN(retry)) {\n\t\t\t\t\t\t\tthis.reconnectInterval = retry;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\t}]);\n\n\treturn EventStream;\n}(_events.EventEmitter);\n\nexports.default = EventStream;\nmodule.exports = exports['default'];\n//# sourceMappingURL=EventStream.js.map"]}